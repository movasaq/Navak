{% extends "admin/base.html" %}



{% block title %}
    مدیریت کاربران سامانه
{% endblock %}

{% block admin_styles %}
{% endblock %}

{% block admin_content %}
    <div class="container-fluid">
        <h4 class="text-center">مدیریت کاربران سامانه</h4>
        <div class="row">
            <div class="col-12 my-3">
                <button class="btn btn-danger  delete-user">حذف کاربر</button>
                <button class="btn btn-warning edit-user">ویرایش کاربر</button>
                <button class="btn btn-success add-user">اضافه کردن کاربر</button>
            </div>

            <div class="col-12" dir="rtl">
                <form action="{{ url_for('admin.add_user') }}" class="d-none my-5" id="ADD-form" method="POST">
                    <h4 class="text-center">اضافه کردن کاربر جدید به سامانه</h4>
                    <label for="new-username" class="w-100">
                        <p class="m-0">نام کاربری: </p>
                        {{ addform.username(class="form-control", id="new-username", placeholder="نام کاربری به صورت انگلیسی") }}
                        <p class="text-center text-center text-muted">به صورت انگلیسی وارد شود: مانند alisharify</p>
                    </label>
                    <label for="new-password" class="w-100">
                        <p class="m-0">گذرواژه حساب کاربری: </p>
                        {{ addform.password(class="form-control", id="new-password",  placeholder="گذرواژه حساب کاربری") }}
                        <p class="text-center text-center text-muted">گذرواژه ای با درجه سختی بالا انتخاب کنید</p>
                    </label>
                    <label for="new-persianusename" class="w-100">
                        <p class="m-0">نام کاربری به صورت فارسی: </p>
                        {{ addform.public_username(class="form-control", id="new-persianusename", placeholder="نام کاربری به صورت فارسی") }}
                        <p class="text-center text-center text-muted">این بخش به صورت فارسی وارد شود مثال: علی شریفی</p>
                    </label>
                    <label for="" class="w-100">
                        <p class="m-0">وضعیت حساب کاربری: </p>
                        {{ addform.active(class="list-unstyled m-0 p-0 d-flex justify-content-around align-items-center", id="active") }}
                        <p class="text-center text-center text-muted">مشخص کنید حساب کاربری فعال باشد یا خیر</p>
                    </label>
                    {{ addform.hidden_tag() }}
                    <label for="user-type" class="w-100">
                        <p class="m-0">گروه کاربر را انتخاب کنید: </p>
                        <select name="{{ addform.user_group.name }}" id="user-type" class="form-select">
                            {% for option in addform.user_group %}
                                {% if loop.first %}
                                    <option disabled selected value="None">نوع کاربر را انتخاب کنید</option>
                                {% endif %}
                                {# set id for each select #}
                                {{ option(id=option._value()) }}
                            {% endfor %}
                        </select>
                        <p class="text-center text-center text-muted">در این بخش گروه کاربر را وارد کنید</p>
                    </label>
                    <div class="employee_option">

                    </div>


                    {{ addform.submit(class="btn btn-success w-100", value="ثبت کاربر") }}
                    <div>
                        <h4 class="text-center mt-5">توجه فرمایید</h4>
                        <ul dir="rtl" class="d-flex  flex-column justify-content-center align-items-center text-center">
                            <li>در این قسمت میتوانید کارمند جدید برای سامانه تعریف کنید</li>
                            <li>هر کامند دسترسی های متفاوتی دارند با توجه به گروهی که برای کاربر تعریف می شود</li>
                            <li>در صورت اضافه کردن کاربری به گروه اشتباهی میتوانید از زبانه ویرایش اطلاعات را ویرایش یا
                                از زبانه حذف نمایی و دوباره اضافه کنید
                            </li>
                        </ul>
                    </div>

                </form>

                <form action="{{ url_for('admin.edit_user') }}" id="EDIT-form" class="d-none" method="POST">
                    <h4 class="text-center my-5">برای ویرایش کاربر لطفا نام کابری کاربر را وارد کنید - به صورت
                        انگلیسی</h4>
                    <label for="edit-username" class="w-100">
                        <span>لطفا نام کاربری  کاربر را به صورت انگلیسی وارد نمایید</span>
                        {{ editform.username(class="form-control my-2", placeholder="نام کاربری", id="edit-username") }}
                    </label>
                    {{ editform.hidden_tag() }}
                    {{ editform.submit(class="w-100 btn btn-success", value="ویرایش") }}

                    <div>
                        <h4 class="text-center mt-5">توجه فرمایید</h4>
                        <ul dir="rtl" class="d-flex  flex-column justify-content-center align-items-center text-center">
                            <li>در کادر وارد شده لطفا نام کاربری انگلیسی کاربر را وارد کنید</li>
                            <li>نام کاربری انگلیسی کاربر که در هنگام ساخت برای کاربر توسط ادمین در نظر گرفته میشود را
                                وارد نمایید
                            </li>
                        </ul>
                    </div>

                </form>


                <form action="{{ url_for('admin.delete_user') }}" method="POST" class="d-none" id="DELETE-form">
                    <h5 class="text-center my-3">برای حذف کاربر لطفا نام کاربری کاربر را وارد</h5>
                    <label for="" class="username-delete-form w-100 my-3">
                        <span>نام کاربری کاربر را به صورت انگلیسی وارد کنید</span>
                        {{ deleteform.username(class="form-control", id="username-delete-form" , placeholder="نام کاربری به صورت انگلیسی") }}
                    </label>
                    {{ deleteform.submit(class="btn btn-success w-100 search-user-username", value="جستجو") }}
                    {{ deleteform.hidden_tag() }}

                    <div class="my-5">
                        <h4 class="text-center">توجه فرمایید</h4>
                        <ul class="d-flex flex-column justify-content-center align-items-center">
                            <li>برای حذف کاربر ابتدا باید نام کاربری کاربر را در کادر بالا به صورت انگلیسی وارد کنید
                            </li>
                            <li>در صورت پیدا شده کاربری با نام کاربری وارد شده از شما تاییدیه برای حذف گرفته میشود</li>
                            <li>پس از تایید حساب کاربری به صورت کامل از سامانه حذف می شود</li>
                        </ul>
                    </div>

                </form>


            </div>


            <table class="table table-responsive table-bordered table-dark table-hover text-end">
                <thead>
                <tr>
                    <th>تاریخ ساخت</th>
                    <th>گروه کاری</th>
                    <th>وضعیت</th>
                    <th>نام کاربری</th>
                </tr>
                </thead>
                <tbody>
                {% for user in pages %}
                    <tr>
                        <td>{{ user.created_at | persian_date_time }}</td>
                        <td>{{ user.user_group | group_name }}</td>
                        {% if user.active %}
                            <td>
                                <button class="btn btn-success w-100">
                                {{ "فعال" if  user.active else "غیرفعال" }}</td>
                            </button>
                        {% else %}
                            <td>
                                <button class="btn btn-danger w-100">
                                {{ "فعال" if  user.active else "غیرفعال" }}</td>
                            </button>
                        {% endif %}
                        <td>{{ user.username }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {# pagination for users #}
            {% if pages.iter_pages() %}
                <div class="paginate-news">
                    <ul class="pagination justify-content-center" style="direction: ltr;">
                        {% for page in pages.iter_pages(right_edge=0, left_edge=0, right_current=2, left_current=2) %}

                            {% if page %}
                                {# find current page and active the pagination #}
                                {% if content.curent_page == page %}
                                    <li class="page-item active"><a
                                            href="{{ url_for('admin.manage_users', page=page) }}"
                                            class="page-link">{{ page }}</a></li>
                                {% else %}
                                    <li class="page-item"><a href="{{ url_for('admin.manage_users', page=page) }}"
                                                             class="page-link">{{ page }}</a></li>
                                {% endif %}

                            {% else %}
                                <li class="page-item"><a class="page-link">...</a></li>
                            {% endif %}

                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <div class="col-12 my-5">
                <h4 class="text-center">توجه فرمایید</h4>
                <ul dir="rtl" class="d-flex flex-column justify-content-center align-items-center">
                    <li>در این پنل میتوانید کاربران جدید به سامانه اضافه یا ویرایش یا حذف کنید</li>
                    <li>توجه در صورت حذف کاربر امکان بازگشت وجود ندارد</li>
                </ul>
            </div>
        </div>

    </div>
{% endblock %}


{% block admin_scripts %}
    <script src="{{ url_for('admin.static_admin', path='js/manage-users.js') }}"></script>

    <script>
        let loginform = document.querySelector("#ADD-form");
        loginform.addEventListener("submit", (e) => {
            // make sure user select type
            if (document.querySelector("#user-type").selectedIndex == 0) {
                window.alert("لطفا نوع کاربر را انتخاب کنید");
                e.preventDefault();
            } else {
                loginform.submit();
            }
        })
    </script>
{% endblock %}